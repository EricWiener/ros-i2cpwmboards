<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>i2cpwm_board: Topics with subscribers provided by this package</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">i2cpwm_board
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">ROS Package for PCA9685 based 16 channel PWM Board with I2C Interface</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Topics with subscribers provided by this package</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaa3fe8c6f5a98243c302c0d27cea219d9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___topics.html#gaa3fe8c6f5a98243c302c0d27cea219d9">servos_absolute</a> (const i2cpwm_board::ServoArray::ConstPtr &amp;msg)</td></tr>
<tr class="memdesc:gaa3fe8c6f5a98243c302c0d27cea219d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">subscriber topic to move servos in a physical position  <a href="#gaa3fe8c6f5a98243c302c0d27cea219d9">More...</a><br /></td></tr>
<tr class="separator:gaa3fe8c6f5a98243c302c0d27cea219d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1262b2e51072c237c51b6de4cb199e53"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___topics.html#ga1262b2e51072c237c51b6de4cb199e53">servos_proportional</a> (const i2cpwm_board::ServoArray::ConstPtr &amp;msg)</td></tr>
<tr class="memdesc:ga1262b2e51072c237c51b6de4cb199e53"><td class="mdescLeft">&#160;</td><td class="mdescRight">subscriber topic to move servos in the range of ±1000  <a href="#ga1262b2e51072c237c51b6de4cb199e53">More...</a><br /></td></tr>
<tr class="separator:ga1262b2e51072c237c51b6de4cb199e53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae257665eb64139d2720ed332e61507c6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___topics.html#gae257665eb64139d2720ed332e61507c6">servos_drive</a> (const geometry_msgs::Twist::ConstPtr &amp;msg)</td></tr>
<tr class="memdesc:gae257665eb64139d2720ed332e61507c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">subscriber topic to move servos based on a drive mode  <a href="#gae257665eb64139d2720ed332e61507c6">More...</a><br /></td></tr>
<tr class="separator:gae257665eb64139d2720ed332e61507c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gaa3fe8c6f5a98243c302c0d27cea219d9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void servos_absolute </td>
          <td>(</td>
          <td class="paramtype">const i2cpwm_board::ServoArray::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="i2cpwm__controller_8cpp.html">src/i2cpwm_controller.cpp</a>&gt;</code></p>

<p>subscriber topic to move servos in a physical position </p>
<p>subscriber for the servos_absolute topic which processes one or more servos and sets their physical pulse value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>a 'ServoArray' message (array of one or more 'Servo') where the servo:value is the pulse position/speed</td></tr>
  </table>
  </dd>
</dl>
<p><b>rostopic example:</b> <code>rostopic pub -1 /servos_absolute i2cpwm_board/ServoArray "{servos:[{servo: 1, value: 200}, {servo: 2, value: 200}]}"</code></p>
<p><b>i2cpwm_board::ServoArray</b> </p><div class="fragment"><div class="line"># the ServoArray message is commonly used message in this package to</div><div class="line"># handle multiple assignments of values to servos. the purpose of</div><div class="line"># the value is dependent on the topic or service being called</div><div class="line"></div><div class="line">Servo[] servos</div></div><!-- fragment --><p> <b>i2cpwm_board::Servo</b> </p><div class="fragment"><div class="line"># the Servo message is commonly used message in this package to</div><div class="line"># assign a value to a specific servo. the purpose of the value is</div><div class="line"># dependent on the topic or service being called</div><div class="line"></div><div class="line">int16 servo</div><div class="line">int16 value</div></div><!-- fragment --> 
<p>Definition at line <a class="el" href="i2cpwm__controller_8cpp_source.html#l00587">587</a> of file <a class="el" href="i2cpwm__controller_8cpp_source.html">i2cpwm_controller.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;{</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="comment">/* this subscription works on the active_board */</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    </div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordflow">for</span>(std::vector&lt;i2cpwm_board::Servo&gt;::const_iterator sp = msg-&gt;servos.begin(); sp != msg-&gt;servos.end(); ++sp) {</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="keywordtype">int</span> servo = sp-&gt;servo;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <span class="keywordtype">int</span> value = sp-&gt;value;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        ROS_DEBUG(<span class="stringliteral">&quot;servos_absolute processing servo=%d value=%d&quot;</span>, servo, value);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordflow">if</span> ((servo &lt; 1) &amp;&amp; (servo &gt; 16)) {</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            ROS_ERROR(<span class="stringliteral">&quot;Invalid servo number %d :: servo numbers must be between 1 and 16&quot;</span>, servo);</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        }</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="keywordflow">if</span> ((value &lt; 0) || (value &gt; 4096)) {</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            ROS_ERROR(<span class="stringliteral">&quot;Invalid PWM value %d :: PWM values must be between 0 and 4096&quot;</span>, value);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        }</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        _set_pwm_interval (servo, 0, value);</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        ROS_INFO(<span class="stringliteral">&quot;servo[%d] = %d&quot;</span>, servo, value);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    }</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga1262b2e51072c237c51b6de4cb199e53"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void servos_proportional </td>
          <td>(</td>
          <td class="paramtype">const i2cpwm_board::ServoArray::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="i2cpwm__controller_8cpp.html">src/i2cpwm_controller.cpp</a>&gt;</code></p>

<p>subscriber topic to move servos in the range of ±1000 </p>
<p>A subscriber for the controling servos using proportional valued. This topic processes one or more servos and sets their physical pulse value based on each servos physical range proportional to a range of ±1000.</p>
<p>This topic requires the use of the <a class="el" href="group___services.html#gabf512716d4497c6a4cb7bf9c5d94e2f1" title="store configuration data for servos on the active board ">config_servos()</a> service. The center, direction, and range are used to convert the proportional to a physical position value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>a 'ServoArray' message (array of one or more 'Servo') where the servo:value is a relative position/speed</td></tr>
  </table>
  </dd>
</dl>
<p><b>rostopic example:</b> <code>rostopic pub -1 /servos_proportion i2cpwm_board/ServoArray "{servos:[{servo: 1, value: -100}]}"</code></p>
<p><b>i2cpwm_board::ServoArray Message</b> </p><div class="fragment"><div class="line"># the ServoArray message is commonly used message in this package to</div><div class="line"># handle multiple assignments of values to servos. the purpose of</div><div class="line"># the value is dependent on the topic or service being called</div><div class="line"></div><div class="line">Servo[] servos</div></div><!-- fragment --><p> <b>i2cpwm_board::Servo Message</b> </p><div class="fragment"><div class="line"># the Servo message is commonly used message in this package to</div><div class="line"># assign a value to a specific servo. the purpose of the value is</div><div class="line"># dependent on the topic or service being called</div><div class="line"></div><div class="line">int16 servo</div><div class="line">int16 value</div></div><!-- fragment --> 
<p>Definition at line <a class="el" href="i2cpwm__controller_8cpp_source.html#l00628">628</a> of file <a class="el" href="i2cpwm__controller_8cpp_source.html">i2cpwm_controller.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;{</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="comment">/* this subscription works on the active_board */</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordflow">for</span>(std::vector&lt;i2cpwm_board::Servo&gt;::const_iterator sp = msg-&gt;servos.begin(); sp != msg-&gt;servos.end(); ++sp) {</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="keywordtype">int</span> servo = sp-&gt;servo;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordtype">int</span> value = sp-&gt;value;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        _set_pwm_interval_proportional (servo, value);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    }</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gae257665eb64139d2720ed332e61507c6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void servos_drive </td>
          <td>(</td>
          <td class="paramtype">const geometry_msgs::Twist::ConstPtr &amp;&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="i2cpwm__controller_8cpp.html">src/i2cpwm_controller.cpp</a>&gt;</code></p>

<p>subscriber topic to move servos based on a drive mode </p>
<p>A subscriber for the servos_drive topic which processes a geometry Twist message and translates it to proportional pulse values for the pre-specified servos. This requires the use of both the drive_mode() and servos_config() services.</p>
<p>The center, direction, and range are used to convert the proportional to a physical position value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>a geometry Twist message</td></tr>
  </table>
  </dd>
</dl>
<p><b>geometry_msgs::Twist</b> </p><div class="fragment"><div class="line"># This expresses velocity in free space broken into its linear and angular parts.</div><div class="line">Vector3  linear</div><div class="line">Vector3  angular</div></div><!-- fragment --><p> <b>geometry_msgs::Vector3</b> </p><div class="fragment"><div class="line"># This represents a vector in free space. </div><div class="line"># It is only meant to represent a direction. Therefore, it does not</div><div class="line"># make sense to apply a translation to it (e.g., when applying a </div><div class="line"># generic rigid transformation to a Vector3, tf2 will only apply the</div><div class="line"># rotation). If you want your data to be translatable too, use the</div><div class="line"># geometry_msgs/Point message instead.</div><div class="line"></div><div class="line">float64 x</div><div class="line">float64 y</div><div class="line">float64 z</div></div><!-- fragment --> 
<p>Definition at line <a class="el" href="i2cpwm__controller_8cpp_source.html#l00658">658</a> of file <a class="el" href="i2cpwm__controller_8cpp_source.html">i2cpwm_controller.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;{</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="comment">/* this subscription works on the active_board */</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordtype">int</span> swap;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keywordtype">int</span> temp_x, temp_y, temp_r, dir_x, dir_y, dir_r;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordtype">int</span> speed[4];</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    </div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="comment">/* msg is a pointer to a Twist message: msg-&gt;linear and msg-&gt;angular each of which have members .x .y .z */</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="comment">/* the subscriber uses the maths from: http://robotsforroboticists.com/drive-kinematics/ */</span> </div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    ROS_INFO(<span class="stringliteral">&quot;[%5.2f %5.2f %5.2f] [%5.2f %5.2f %5.2f]&quot;</span>, </div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;             msg-&gt;linear.x, msg-&gt;linear.y, msg-&gt;linear.z, msg-&gt;angular.x, msg-&gt;angular.y, msg-&gt;angular.z);</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keywordflow">if</span> (_active_drive.mode == MODE_UNDEFINED) {</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        ROS_ERROR(<span class="stringliteral">&quot;drive mode not set&quot;</span>);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    }</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">if</span> ((_active_drive.mode &lt; MODE_UNDEFINED) || (_active_drive.mode &gt;= MODE_INVALID)) {</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        ROS_ERROR(<span class="stringliteral">&quot;unrecognized drive mode set %d&quot;</span>, _active_drive.mode);</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    }</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    dir_x = ((msg-&gt;linear.x &gt; 0)  ? 1 : -1);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    dir_y = ((msg-&gt;linear.y &gt; 0)  ? 1 : -1);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    dir_r = ((msg-&gt;angular.z &gt; 0) ? 1 : -1);</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    temp_x = _abs(msg-&gt;linear.x);</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    temp_y = _abs(msg-&gt;linear.x);</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    temp_r = _abs(msg-&gt;angular.z);</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        </div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    temp_x = _smoothing (temp_x);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    temp_y = _smoothing (temp_y);</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    temp_r = _smoothing (temp_r) / 2;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">switch</span> (_active_drive.mode) {</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="keywordflow">case</span> MODE_ACKERMAN:</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">          with ackerman drive, steering is handled by a separate servo</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">          we drive assigned servos exclusively by the linear.x</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        speed[0] = temp_x * dir_x;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        ROS_INFO(<span class="stringliteral">&quot;ackerman drive mode speed=%d&quot;</span>, speed[0]);</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordflow">case</span> MODE_DIFFERENTIAL:</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">          with differential drive, steering is handled by the relative speed of left and right servos</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">          we drive assigned servos by mixing linear.x and angular.z with a very simple formula</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        speed[0] = temp_x * dir_x;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        speed[1] = (temp_x - temp_r) * dir_x;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="keywordflow">if</span> (dir_r &lt; 0) {</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            swap = speed[0];</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            speed[0] = speed[1];</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            speed[1] - swap;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        }</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        ROS_INFO(<span class="stringliteral">&quot;differential drive mode speed left=%d right=%d&quot;</span>, speed[0], speed[1]);</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">case</span> MODE_MECANUM:</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">          with mecanum drive, steering is handled by the relative speed of left and right servos</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">          with mecanum drive, lateral motion is handled by the rotation of front and rear servos</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment">          we drive assigned servos by mixing linear.x and angular.z  and linear.y</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        speed[0] = speed[2] = temp_x * dir_x;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        speed[1] = speed[3] = (temp_x - temp_r) * dir_x;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        speed[0] -= temp_y * dir_y;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        speed[3] -= temp_y * dir_y;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        speed[1] += temp_y * dir_y;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        speed[2] += temp_y * dir_y;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        speed[0] = _absmax (speed[0], 1000);</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        speed[1] = _absmax (speed[1], 1000);</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        speed[2] = _absmax (speed[2], 1000);</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        speed[3] = _absmax (speed[3], 1000);</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        ROS_INFO(<span class="stringliteral">&quot;mecanum drive mode speed leftfront=%d rightfront=%d leftrear=%d rightreer=%d&quot;</span>, speed[0], speed[1], speed[2], speed[3]);</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    }</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        </div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="comment">/* find all drive servos and set their new speed */</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;16; i++) {</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="keywordflow">if</span> (_servo_configs[_active_board-1][i].mode_pos == POSITION_LEFTFRONT)</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            _set_pwm_interval_proportional (i+1, speed[0]);</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="keywordflow">if</span> (_servo_configs[_active_board-1][i].mode_pos == POSITION_RIGHTFRONT)</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            _set_pwm_interval_proportional (i+1, speed[1]);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <span class="keywordflow">if</span> (_servo_configs[_active_board-1][i].mode_pos == POSITION_LEFTREAR)</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            _set_pwm_interval_proportional (i+1, speed[3]);</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="keywordflow">if</span> (_servo_configs[_active_board-1][i].mode_pos == POSITION_RIGHTREAR)</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            _set_pwm_interval_proportional (i+1, speed[2]);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    }</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
