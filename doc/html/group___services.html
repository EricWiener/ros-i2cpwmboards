<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>i2cpwm_board: Services interfaces provided by this package</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">i2cpwm_board
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">ROS Package for PCA9685 based 16 channel PWM Board with I2C Interface</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Services interfaces provided by this package</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga948cb0dd7ba8c2ac4c7f2d2d93940d85"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___services.html#ga948cb0dd7ba8c2ac4c7f2d2d93940d85">set_pwm_frequency</a> (i2cpwm_board::IntValue::Request &amp;req, i2cpwm_board::IntValue::Response &amp;res)</td></tr>
<tr class="memdesc:ga948cb0dd7ba8c2ac4c7f2d2d93940d85"><td class="mdescLeft">&#160;</td><td class="mdescRight">service to set set PWM frequency  <a href="#ga948cb0dd7ba8c2ac4c7f2d2d93940d85">More...</a><br /></td></tr>
<tr class="separator:ga948cb0dd7ba8c2ac4c7f2d2d93940d85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae3a9251a5afb53de589256f5b3b5f82b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___services.html#gae3a9251a5afb53de589256f5b3b5f82b">set_pwm_active_board</a> (i2cpwm_board::IntValue::Request &amp;req, i2cpwm_board::IntValue::Response &amp;res)</td></tr>
<tr class="memdesc:gae3a9251a5afb53de589256f5b3b5f82b"><td class="mdescLeft">&#160;</td><td class="mdescRight">service to set active PWM board  <a href="#gae3a9251a5afb53de589256f5b3b5f82b">More...</a><br /></td></tr>
<tr class="separator:gae3a9251a5afb53de589256f5b3b5f82b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabf512716d4497c6a4cb7bf9c5d94e2f1"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___services.html#gabf512716d4497c6a4cb7bf9c5d94e2f1">config_servos</a> (i2cpwm_board::ServosConfig::Request &amp;req, i2cpwm_board::ServosConfig::Response &amp;res)</td></tr>
<tr class="memdesc:gabf512716d4497c6a4cb7bf9c5d94e2f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">store configuration data for servos on the active board  <a href="#gabf512716d4497c6a4cb7bf9c5d94e2f1">More...</a><br /></td></tr>
<tr class="separator:gabf512716d4497c6a4cb7bf9c5d94e2f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae3222f92a0cd33b0d0a2fcfd6d563ba9"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___services.html#gae3222f92a0cd33b0d0a2fcfd6d563ba9">config_drive_mode</a> (i2cpwm_board::DriveMode::Request &amp;req, i2cpwm_board::DriveMode::Response &amp;res)</td></tr>
<tr class="memdesc:gae3222f92a0cd33b0d0a2fcfd6d563ba9"><td class="mdescLeft">&#160;</td><td class="mdescRight">set drive mode and drive servos  <a href="#gae3222f92a0cd33b0d0a2fcfd6d563ba9">More...</a><br /></td></tr>
<tr class="separator:gae3222f92a0cd33b0d0a2fcfd6d563ba9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4583b417d172bde68e75db603da3362e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___services.html#ga4583b417d172bde68e75db603da3362e">stop_servos</a> (std_srvs::Empty::Request &amp;req, std_srvs::Empty::Response &amp;res)</td></tr>
<tr class="memdesc:ga4583b417d172bde68e75db603da3362e"><td class="mdescLeft">&#160;</td><td class="mdescRight">service to stop all servos on all boards  <a href="#ga4583b417d172bde68e75db603da3362e">More...</a><br /></td></tr>
<tr class="separator:ga4583b417d172bde68e75db603da3362e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga948cb0dd7ba8c2ac4c7f2d2d93940d85"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool set_pwm_frequency </td>
          <td>(</td>
          <td class="paramtype">i2cpwm_board::IntValue::Request &amp;&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">i2cpwm_board::IntValue::Response &amp;&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="i2cpwm__controller_8cpp.html">src/i2cpwm_controller.cpp</a>&gt;</code></p>

<p>service to set set PWM frequency </p>
<p>The PWM boards drive LED and servos using pulse width modulation. The 12 bit interface means values are 0..4096. The size of the minimum width is determined by the frequency. is service is needed when using a board configured other than with the default I2C address and when using multiple boards.</p>
<p>If using the pwm_active_board service, it must be used before using other services or topics from this package.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">req</td><td>an Int16 value for which board should be active(1..62). </td></tr>
    <tr><td class="paramname">res</td><td>the return value </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>an integer non-zero if an error occured</dd></dl>
<p>Example request: "{}"</p>
<p><b>i2cpwm_board::IntValue</b> </p><div class="fragment"><div class="line"># there are a few services whic take a single integer as input</div><div class="line"># these services share the IntValue service definition</div><div class="line"></div><div class="line">int16 value</div><div class="line">---</div><div class="line">int16 error</div><div class="line"></div></div><!-- fragment --> 
<p>Definition at line <a class="el" href="i2cpwm__controller_8cpp_source.html#l00779">779</a> of file <a class="el" href="i2cpwm__controller_8cpp_source.html">i2cpwm_controller.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;{</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keywordtype">int</span> freq;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    freq = req.value;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">if</span> ((freq&lt;12) || (freq&gt;1024)) {</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        ROS_ERROR(<span class="stringliteral">&quot;Invalid PWM frequency %d :: PWM frequencies should be between 12 and 1024&quot;</span>, freq);</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        freq = 50;  <span class="comment">// most analog RC servos are designed for 20ms pulses.</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        res.error = freq;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    }</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    _set_pwm_frequency (freq);  <span class="comment">// I think we must reset frequency when we change boards</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    res.error = freq;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gae3a9251a5afb53de589256f5b3b5f82b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool set_pwm_active_board </td>
          <td>(</td>
          <td class="paramtype">i2cpwm_board::IntValue::Request &amp;&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">i2cpwm_board::IntValue::Response &amp;&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="i2cpwm__controller_8cpp.html">src/i2cpwm_controller.cpp</a>&gt;</code></p>

<p>service to set active PWM board </p>
<p>A service to set or switch which PWM board is active. By default, board #0 is active and uses I2C 0x40 address. the PWM boards which use the PCA9685 chip support addresses in the range 0x40 to 0x7E.</p>
<p>This service is needed when using a board configured other than with the default I2C address and when using multiple boards. If using the pwm_active_board service, it must be used before using other services or topics from this package.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">req</td><td>an Int16 value for which board should be active(1..62). </td></tr>
    <tr><td class="paramname">res</td><td>the return value </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>an integer non-zero if an error occured</dd></dl>
<p>Example request: "{}"</p>
<p><b>i2cpwm_board::IntValue</b> </p><div class="fragment"><div class="line"># there are a few services whic take a single integer as input</div><div class="line"># these services share the IntValue service definition</div><div class="line"></div><div class="line">int16 value</div><div class="line">---</div><div class="line">int16 error</div><div class="line"></div></div><!-- fragment --> 
<p>Definition at line <a class="el" href="i2cpwm__controller_8cpp_source.html#l00811">811</a> of file <a class="el" href="i2cpwm__controller_8cpp_source.html">i2cpwm_controller.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;{</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keywordtype">int</span> board;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    res.error = 0;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    board = req.value;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="keywordflow">if</span> ((board&lt;1) || (board&gt;62)) {</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        ROS_ERROR(<span class="stringliteral">&quot;Invalid board number %d :: PWM board numbers must be between 1 and 62&quot;</span>, board);</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        board = 1;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    }</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    _set_active_board (board);</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    _set_pwm_frequency (_pwm_frequency);    <span class="comment">// I think we must reset frequency when we change boards</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    res.error = board;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gabf512716d4497c6a4cb7bf9c5d94e2f1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool config_servos </td>
          <td>(</td>
          <td class="paramtype">i2cpwm_board::ServosConfig::Request &amp;&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">i2cpwm_board::ServosConfig::Response &amp;&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="i2cpwm__controller_8cpp.html">src/i2cpwm_controller.cpp</a>&gt;</code></p>

<p>store configuration data for servos on the active board </p>
<p>A service to set each servo's center value, direction of rotation (1 for forward and -1 for reverse motion), the center or nul value, range, and direction of one or more servos. and range between full left and right or maximun forward and backward speed.</p>
<p>Setting these data are required before sending messages to the <a class="el" href="group___topics.html#ga1262b2e51072c237c51b6de4cb199e53" title="subscriber topic to move servos in the range of ±1000 ">servos_proportional()</a> topic as well as the <a class="el" href="group___topics.html#gae257665eb64139d2720ed332e61507c6" title="subscriber topic to move servos based on a drive mode ">servos_drive()</a> topic.</p>
<p>If more than one PWM board is present, the <a class="el" href="group___services.html#gae3a9251a5afb53de589256f5b3b5f82b" title="service to set active PWM board ">set_pwm_active_board()</a> service is used to switch between boards prior to configuring servos.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">req</td><td>an array of 'ServoConfig' which consists of a servo number (one based), center(0..4096), range(0..4096), and direction (±1). </td></tr>
    <tr><td class="paramname">res</td><td>the return value </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>an integer non-zero if an error occured</dd></dl>
<p><b>rosservice example:</b> <code>rosservice call /config_servos "servos: [{servo: 1, center: 336, range: 96, direction: 1}]"</code></p>
<p>__i2cpwm_board::ServosConfig___ </p><div class="fragment"><div class="line"># the servos_config service is used to assign useful configuration data to servos</div><div class="line"># the tollerance of electronis varies in RC servos so it is important to calibate</div><div class="line"># each servo, indicating its PWM value for direction of rotation, centering, and</div><div class="line"># range which is used to scale servo motion a standard ±1000 scale</div><div class="line"></div><div class="line">ServoConfig[] servos</div><div class="line">---</div><div class="line">int16 error</div></div><!-- fragment --> 
<p>Definition at line <a class="el" href="i2cpwm__controller_8cpp_source.html#l00847">847</a> of file <a class="el" href="i2cpwm__controller_8cpp_source.html">i2cpwm_controller.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;{</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="comment">/* this service works on the active_board */</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    </div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    res.error = 0;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keywordflow">if</span> ((_active_board&lt;1) || (_active_board&gt;62)) {</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        ROS_ERROR(<span class="stringliteral">&quot;Invalid board number %d :: PWM board numbers must be between 1 and 62&quot;</span>, _active_board);</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        res.error = -1;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    }</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="keywordflow">for</span> (i=0;i&lt;req.servos.size();i++) {</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="keywordtype">int</span> servo = req.servos[i].servo;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        <span class="keywordtype">int</span> center = req.servos[i].center;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        <span class="keywordtype">int</span> range = req.servos[i].range;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="keywordtype">int</span> direction = req.servos[i].direction;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        <span class="keywordflow">if</span> ((servo &lt; 1) || (servo &gt; 16)) {</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            ROS_ERROR(<span class="stringliteral">&quot;Invalid servo number %d :: servo numbers must be between 1 and 16&quot;</span>, servo);</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            res.error = servo; <span class="comment">/* this needs to be more specific and indicate a bad server ID was provided */</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        }</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <span class="keywordflow">if</span> ((center &lt; 0) || (center &gt; 4096)) {</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            ROS_ERROR(<span class="stringliteral">&quot;Invalid center value %d :: center values must be between 0 and 4096&quot;</span>, center);</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        }</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        <span class="keywordflow">if</span> ((center &lt; 0) || (center &gt; 4096)) {</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            ROS_ERROR(<span class="stringliteral">&quot;Invalid range value %d :: range values must be between 0 and 4096&quot;</span>, range);</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        }</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        <span class="keywordflow">if</span> (((center - (range/2)) &lt; 0) || (((range/2) + center) &gt; 4096)) {</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            ROS_ERROR(<span class="stringliteral">&quot;Invalid range center combination %d ± %d :: range/2 ± center must be between 0 and 4096&quot;</span>, center, (range/2));</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        }</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        _servo_configs[_active_board-1][servo-1].center = center;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        _servo_configs[_active_board-1][servo-1].range = range;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        _servo_configs[_active_board-1][servo-1].direction = direction;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        _servo_configs[_active_board-1][servo-1].mode_pos = POSITION_UNDEFINED;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    }</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gae3222f92a0cd33b0d0a2fcfd6d563ba9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool config_drive_mode </td>
          <td>(</td>
          <td class="paramtype">i2cpwm_board::DriveMode::Request &amp;&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">i2cpwm_board::DriveMode::Response &amp;&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="i2cpwm__controller_8cpp.html">src/i2cpwm_controller.cpp</a>&gt;</code></p>

<p>set drive mode and drive servos </p>
<p>A service to set the desired drive mode. It must be called before messages are handled by the <a class="el" href="group___topics.html#gae257665eb64139d2720ed332e61507c6" title="subscriber topic to move servos based on a drive mode ">servos_drive()</a> topic. Setting these data are required before sending messages to the <a class="el" href="group___topics.html#ga1262b2e51072c237c51b6de4cb199e53" title="subscriber topic to move servos in the range of ±1000 ">servos_proportional()</a> topic.</p>
<p>The drive mode consists of a string value for the type of drive desired: ackerman, differential, or mecanum. For each mode, the drive servos must be specified.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">req</td><td>is DriveMode with a string and a ServoArray' which consists of a servo number (1..16) and a value (1..4) indicating the drive sequence </td></tr>
    <tr><td class="paramname">res</td><td>the return value </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>an integer non-zero if an error occured</dd></dl>
<p>The mode string is one of the following drive systems:</p><ol type="1">
<li>'ackerman' - (automobile steering) requires minimum of one servo for drive and uses some other servo for stearing..</li>
<li>'differential' - requires multiples of two servos, designated as left and right.</li>
<li>'mecanum' - requires multiples of four servos, designated as left-front, right-front, left-rear, and right-rear.</li>
</ol>
<p>The servo message is used for indicating which servos are used for the drive system. The message consists of 'servo' number, and data 'value'.</p>
<p>The 'value' field indicates the positon the corresponding servo within the drive system. The applicable servos are assigned positions as follows:</p>
<table class="doxtable">
<tr>
<th>positon </th><th>ackerman </th><th>differential </th><th>mecanum  </th></tr>
<tr>
<td>position 1 corresponds to </td><td>drive </td><td>left </td><td>left-front </td></tr>
<tr>
<td>position 2 corresponds to </td><td></td><td>right </td><td>right-front </td></tr>
<tr>
<td>position 3 corresponds to </td><td></td><td></td><td>left-rear </td></tr>
<tr>
<td>position 4 corresponds to </td><td></td><td></td><td>right-rear </td></tr>
</table>
<p>Example request: "{}"</p>
<p><b>i2cpwm_board::DriveMode</b> </p><div class="fragment"><div class="line"># the drive_mode service is used to assigned servos to various drive modes</div><div class="line"># the drive modes determine how the assigned servos respond to geometry Twist messages</div><div class="line"># drive modes are one of: ackerman, differential, or mecanum</div><div class="line"># scalar is used to scale incoming Twist values to the  ±1000 scale used by this package</div><div class="line"></div><div class="line">string mode</div><div class="line">int16 scale</div><div class="line">Servo[] servos</div><div class="line">---</div><div class="line">int16 error</div></div><!-- fragment --> 
<p>Definition at line <a class="el" href="i2cpwm__controller_8cpp_source.html#l00929">929</a> of file <a class="el" href="i2cpwm__controller_8cpp_source.html">i2cpwm_controller.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;{</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    res.error = 0;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keywordtype">int</span> mode = MODE_UNDEFINED;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordtype">float</span> scale;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="comment">// assumes the parameter was provided in the proper case</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="keywordflow">if</span>      (0 == strcmp (req.mode.c_str(), _CONST(<span class="stringliteral">&quot;ackerman&quot;</span>)))</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        mode = MODE_ACKERMAN;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strcmp (req.mode.c_str(), _CONST(<span class="stringliteral">&quot;differential&quot;</span>)))</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        mode = MODE_DIFFERENTIAL;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strcmp (req.mode.c_str(), _CONST(<span class="stringliteral">&quot;mecanum&quot;</span>)))</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        mode = MODE_MECANUM;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        mode = MODE_INVALID;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        ROS_ERROR(<span class="stringliteral">&quot;Invalid drive mode %s :: drive mode must be one of ackerman, differential, or mecanum&quot;</span>, req.mode.c_str());</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        res.error = -1;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    }</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    _active_drive.mode = mode;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    scale = req.scale;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keywordflow">if</span> (scale &lt;= 0.0) {</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        ROS_ERROR(<span class="stringliteral">&quot;Invalid scale %f :: the scalar for Twist messages must be greater than 0.0&quot;</span>, scale);</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        res.error = -1;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    }</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    _active_drive.mode = mode;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    _active_drive.scale = scale;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="keywordflow">for</span> (i=0;i&lt;req.servos.size();i++) {</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        <span class="keywordtype">int</span> servo = req.servos[i].servo;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <span class="keywordtype">int</span> position = req.servos[i].value;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        <span class="keywordflow">if</span> ((_active_board &lt; 1) || (_active_board &gt; 62)) {</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;            ROS_ERROR(<span class="stringliteral">&quot;Invalid board number %d :: board numbers must be between 1 and 62&quot;</span>, _active_board);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;            res.error = servo; <span class="comment">/* this needs to be more specific and indicate a bad server ID was provided */</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        }</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        <span class="keywordflow">if</span> ((servo &lt; 1) || (servo &gt; 16)) {</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;            ROS_ERROR(<span class="stringliteral">&quot;Invalid servo number %d :: servo numbers must be between 1 and 16&quot;</span>, servo);</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;            res.error = servo; <span class="comment">/* this needs to be more specific and indicate a bad server ID was provided */</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        }</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <span class="keywordflow">if</span> ((position &lt; POSITION_UNDEFINED) || (position &gt; POSITION_LEFTREAR)) {</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            ROS_ERROR(<span class="stringliteral">&quot;Invalid drive mode position %d :: positions are 0 = non-drive, 1 = left front, 2 = right front, 3 = left rear, and 4 = right rear&quot;</span>, position);</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        }</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        _servo_configs[_active_board-1][servo-1].mode_pos = position;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    }</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga4583b417d172bde68e75db603da3362e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool stop_servos </td>
          <td>(</td>
          <td class="paramtype">std_srvs::Empty::Request &amp;&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std_srvs::Empty::Response &amp;&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>#include &lt;<a class="el" href="i2cpwm__controller_8cpp.html">src/i2cpwm_controller.cpp</a>&gt;</code></p>

<p>service to stop all servos on all boards </p>
<p>A service to stop all of the servos on all of the PWM boards and set their power state to off / coast.</p>
<p>This is different from setting each servo to its center value. A centered servo is still under power and it's in a brake state.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">req</td><td>is empty </td></tr>
    <tr><td class="paramname">res</td><td>is empty </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>nothing</dd></dl>
<p><b>rosservice example:</b> <code>rosservice call /stop_servos</code> </p>

<p>Definition at line <a class="el" href="i2cpwm__controller_8cpp_source.html#l01002">1002</a> of file <a class="el" href="i2cpwm__controller_8cpp_source.html">i2cpwm_controller.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;{</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="keywordtype">int</span> save_active = _active_board;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="keywordflow">for</span> (i=0; i&lt;62; i++) {</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        <span class="keywordflow">if</span> (_pwm_boards[i] &gt; 0) {</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;            _set_active_board (i+1);    <span class="comment">// API is ONE based</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            _set_pwm_interval_all (0, 0);</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        }</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    }</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    _active_board = save_active;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
